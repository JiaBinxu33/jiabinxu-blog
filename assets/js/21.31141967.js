(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{281:function(e,t,s){},291:function(e,t,s){"use strict";s(281)},300:function(e,t,s){"use strict";s.r(t);s(121),s(63),s(14),s(43);var n=s(309),i={name:"MiniSearch",data:()=>({miniSearch:null,searchIndex:[],searchQuery:"",suggestions:[],focused:!1,focusIndex:0,placeholder:"搜索...",alignRight:!1,CJK_REGEX:/[\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF]/}),computed:{showSuggestions(){return this.focused&&(this.suggestions.length>0||this.searchQuery)},searchInputStyle(){return{"background-image":`url(${this.$withBase("/search.svg")})`}}},async mounted(){this.placeholder=this.$site.themeConfig.searchPlaceholder||"搜索...",await this.loadIndex(),this.initMiniSearch()},methods:{async loadIndex(){try{const e=await fetch(this.$withBase("/search-index.json"));if(!e.ok)throw new Error("Search index fetch failed: "+e.status);this.searchIndex=await e.json(),console.log(`[SearchBox Debug] v3 索引已加载, ${this.searchIndex.length} 篇文档.`)}catch(e){console.error("[SearchBox Debug] 加载 v3 索引失败:",e)}},initMiniSearch(){if(!this.searchIndex||0===this.searchIndex.length)return void console.warn("[SearchBox Debug] 索引为空, MiniSearch 无法初始化.");const e=this.CJK_REGEX,t=/[,\.!?();:"'\[\]{}。\uff0c\uff1a\uff08\uff09\u3001\u3002\u300a\u300b\u201c\u201d\u2018\u2019-]/g,s=/[\s\r\n]/g;this.miniSearch=new n.a({fields:["pageTitle","headerTitle","text"],storeFields:["path","pageTitle","headerTitle","text"],tokenize:n=>{if(!n)return[];const i=[];let r="",o=!1;const u=()=>{if(0===r.length)return;const e=o?r.replace(s,""):r;if(0!==e.length){if(o)if(1===e.length)i.push(e);else for(let t=0;t<e.length-1;t++){const s=e.substring(t,t+2);i.push(s)}else i.push(e.toLowerCase());r=""}else r=""};return n.split("").forEach(n=>{const i=e.test(n),h=t.test(n),a=s.test(n);h?(u(),o=!1):a?r.length>0&&!o?(u(),o=!1):o&&(r+=n):i?(r.length>0&&!o&&u(),r+=n,o=!0):(r.length>0&&o&&u(),r+=n,o=!1)}),u(),i},searchOptions:{boost:{pageTitle:3,headerTitle:2,text:1},prefix:!1,fuzzy:!1}}),this.miniSearch.addAll(this.searchIndex),console.log("[SearchBox Debug] MiniSearch v3 已初始化.")},performSearch(){if(this.searchQuery&&this.miniSearch)try{const e={highlight:!0,combineWith:"AND"};this.CJK_REGEX.test(this.searchQuery)||(e.fuzzy=.2,e.prefix=!0);const t=this.miniSearch.search(this.searchQuery,e);this.suggestions=this.groupAndHighlightResults(t,this.searchQuery),this.focusIndex=this.findNextFocusableIndex(-1,"down")}catch(e){console.error("[SearchBox Debug] 搜索出错:",e),this.suggestions=[]}else this.suggestions=[]},groupAndHighlightResults(e,t){const s={},n=new RegExp(`(${this.escapeRegExp(t)})`,"gi");e.slice(0,15).forEach(e=>{const i=e.pageTitle.replace(n,'<span class="highlight-text">$1</span>');s[i]||(s[i]=[]);const r=(e.headerTitle||"概述").replace(n,'<span class="highlight-text">$1</span>'),o=this.createSnippet(e.text,t,e.match.text,n,'<span class="highlight-text">$1</span>');s[i].push({path:e.path,headerTitle:r,snippet:o})});const i=[];for(const e in s)i.push({type:"groupHeader",title:e}),s[e].forEach(e=>{i.push({type:"result",...e})});return i},createSnippet(e,t,s,n,i){if(!e||!t)return"";const r=e.toLowerCase().indexOf(t.toLowerCase());if(-1===r&&(!s||0===s.length))return e.substring(0,80)+(e.length>80?"...":"");let o=r;s&&s.length>0&&(o=s[0][0]);const u=Math.max(0,o-40),h=Math.min(e.length,u+80);let a=e.substring(u,h);return u>0&&(a="..."+a),h<e.length&&(a+="..."),a=a.replace(n,i),a},escapeRegExp:e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),go(e){if(!this.showSuggestions)return;const t=this.suggestions[e];t&&"result"===t.type&&(this.$router.push({path:t.path,query:{search_query:this.searchQuery}}),this.closeDropdown())},closeDropdown(){this.searchQuery="",this.suggestions=[],this.focused=!1,this.$refs.input.blur()},onBlur(){setTimeout(()=>{this.focused=!1},200)},onUp(){this.focusIndex=this.findNextFocusableIndex(this.focusIndex,"up")},onDown(){this.focusIndex=this.findNextFocusableIndex(this.focusIndex,"down")},focus(e){this.focusIndex=e},unfocus(){this.focusIndex=-1},findNextFocusableIndex(e,t){if(!this.suggestions.length)return-1;const s="down"===t?1:-1;let n=e+s;for(;n>=0&&n<this.suggestions.length;){if("result"===this.suggestions[n].type)return n;n+=s}return"up"===t&&n<0?this.findNextFocusableIndex(-1,"down"):"down"===t&&n>=this.suggestions.length?this.findNextFocusableIndex(this.suggestions.length,"up"):e}}},r=(s(291),s(27)),o=Object(r.a)(i,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],ref:"input",class:{focused:e.focused},style:e.searchInputStyle,attrs:{"aria-label":"Search",placeholder:e.placeholder,autocomplete:"off",spellcheck:"false"},domProps:{value:e.searchQuery},on:{input:[function(t){t.target.composing||(e.searchQuery=t.target.value)},e.performSearch],focus:function(t){e.focused=!0},blur:e.onBlur,keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.go(e.focusIndex)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.onUp.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.onDown.apply(null,arguments)}]}}),e._v(" "),e.showSuggestions?t("ul",{staticClass:"suggestions",class:{"align-right":e.alignRight},on:{mouseleave:e.unfocus}},[e._l(e.suggestions,(function(s,n){return t("li",{key:n,class:{"group-header-item":"groupHeader"===s.type,"suggestion-item":"result"===s.type,focused:"result"===s.type&&n===e.focusIndex},on:{mousedown:function(t){"result"===s.type&&e.go(n)},mouseenter:function(t){"result"===s.type&&e.focus(n)}}},["groupHeader"===s.type?[t("div",{staticClass:"group-title",domProps:{innerHTML:e._s(s.title)}})]:"result"===s.type?[t("router-link",{attrs:{to:s.path},nativeOn:{click:function(t){return e.closeDropdown.apply(null,arguments)}}},[t("div",{staticClass:"hierarchy-icon"},[t("span",[e._v("#")])]),e._v(" "),t("div",{staticClass:"suggestion-content"},[t("div",{staticClass:"header-main-title",domProps:{innerHTML:e._s(s.headerTitle)}}),e._v(" "),s.snippet?t("div",{staticClass:"snippet",domProps:{innerHTML:e._s(s.snippet)}}):e._e()])])]:e._e()],2)})),e._v(" "),0===e.suggestions.length&&e.searchQuery?t("li",{staticClass:"suggestion-item no-results"},[t("span",[e._v("没有找到结果")])]):e._e()],2):e._e()])}),[],!1,null,null,null);t.default=o.exports}}]);