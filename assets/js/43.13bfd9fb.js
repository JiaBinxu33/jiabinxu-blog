(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{364:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"usememo-与-usecallback-对比详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usememo-与-usecallback-对比详解"}},[t._v("#")]),t._v(" useMemo 与 useCallback 对比详解")]),t._v(" "),s("p",[t._v("在 React 中，"),s("code",[t._v("useMemo")]),t._v(" 和 "),s("code",[t._v("useCallback")]),t._v(" 都是用于"),s("strong",[t._v("缓存数据或函数")]),t._v("、优化性能的 Hook。它们常被用来减少不必要的计算和渲染，提升应用响应速度。尽管两者用法类似，但各自有明确的适用场景和区别。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"基本定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本定义"}},[t._v("#")]),t._v(" 基本定义")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("useMemo")]),s("br"),t._v("\n用于在组件多次渲染之间"),s("strong",[t._v("缓存一个计算值")]),t._v("，只有依赖项发生变化时才重新计算。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" memoizedValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useMemo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("computeExpensiveValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("useCallback")]),s("br"),t._v("\n用于在组件多次渲染之间"),s("strong",[t._v("缓存一个函数")]),t._v("，只有依赖项发生变化时才生成新的函数引用。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" memoizedCallback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"主要区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要区别"}},[t._v("#")]),t._v(" 主要区别")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("对比项")]),t._v(" "),s("th",[t._v("useMemo")]),t._v(" "),s("th",[t._v("useCallback")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("缓存对象类型")]),t._v(" "),s("td",[s("strong",[t._v("值")]),t._v("（任意类型，如数组、对象、结果等）")]),t._v(" "),s("td",[s("strong",[t._v("函数")]),t._v("（可传递给子组件等）")])]),t._v(" "),s("tr",[s("td",[t._v("返回内容")]),t._v(" "),s("td",[t._v("计算函数的返回值")]),t._v(" "),s("td",[t._v("缓存后的函数本身")])]),t._v(" "),s("tr",[s("td",[t._v("典型场景")]),t._v(" "),s("td",[t._v("高开销的计算、过滤、生成稳定对象/数组")]),t._v(" "),s("td",[t._v("事件处理、回调、传递给 memo 子组件")])]),t._v(" "),s("tr",[s("td",[t._v("用法语义")]),t._v(" "),s("td",[t._v("“记住一个值”")]),t._v(" "),s("td",[t._v("“记住一个函数”")])]),t._v(" "),s("tr",[s("td",[t._v("语法")]),t._v(" "),s("td",[s("code",[t._v("useMemo(fn, deps)")])]),t._v(" "),s("td",[s("code",[t._v("useCallback(fn, deps)")])])]),t._v(" "),s("tr",[s("td",[t._v("依赖变化时")]),t._v(" "),s("td",[t._v("重新计算并返回新值")]),t._v(" "),s("td",[t._v("生成新函数引用")])]),t._v(" "),s("tr",[s("td",[t._v("与 React.memo")]),t._v(" "),s("td",[t._v("保证 props 数据引用稳定，减少子组件渲染")]),t._v(" "),s("td",[t._v("保证回调函数引用稳定，减少子组件渲染")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"相同点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相同点"}},[t._v("#")]),t._v(" 相同点")]),t._v(" "),s("ul",[s("li",[t._v("都接收"),s("strong",[t._v("依赖数组")]),t._v("作为第二个参数，只有依赖变化时才更新缓存。")]),t._v(" "),s("li",[t._v("都是"),s("strong",[t._v("性能优化工具")]),t._v("，只在有性能瓶颈时使用，不要滥用。")]),t._v(" "),s("li",[t._v("都只能在"),s("strong",[t._v("组件顶层")]),t._v("或"),s("strong",[t._v("自定义 Hook")]),t._v("中使用，不能在循环或条件语句中调用。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"典型用法对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#典型用法对比"}},[t._v("#")]),t._v(" 典型用法对比")]),t._v(" "),s("h3",{attrs:{id:"usememo-缓存值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usememo-缓存值"}},[t._v("#")]),t._v(" useMemo：缓存值")]),t._v(" "),s("p",[t._v("适合"),s("strong",[t._v("复杂计算")]),t._v("或"),s("strong",[t._v("生成对象/数组")]),t._v("，如：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 过滤大数据列表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" visibleTodos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useMemo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterTodos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("todos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("todos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"usecallback-缓存函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usecallback-缓存函数"}},[t._v("#")]),t._v(" useCallback：缓存函数")]),t._v(" "),s("p",[t._v("适合"),s("strong",[t._v("事件处理")]),t._v("、"),s("strong",[t._v("回调")]),t._v("，尤其是"),s("strong",[t._v("传递给子组件")]),t._v("时，如：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handleClick "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"实际案例对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实际案例对比"}},[t._v("#")]),t._v(" 实际案例对比")]),t._v(" "),s("h3",{attrs:{id:"_1-优化子组件渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-优化子组件渲染"}},[t._v("#")]),t._v(" 1. 优化子组件渲染")]),t._v(" "),s("h4",{attrs:{id:"传递稳定的数组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传递稳定的数组"}},[t._v("#")]),t._v(" 传递稳定的数组")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" visibleTodos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useMemo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterTodos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("todos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("todos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("List items"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("visibleTodos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// items 引用稳定，memo 优化有效")]),t._v("\n")])])]),s("h4",{attrs:{id:"传递稳定的回调"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传递稳定的回调"}},[t._v("#")]),t._v(" 传递稳定的回调")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handleSubmit "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("orderDetails")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderDetails"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" productId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("productId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Form onSubmit"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("handleSubmit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// onSubmit 引用稳定，memo 优化有效")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h3",{attrs:{id:"_2-防止-effect-频繁触发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-防止-effect-频繁触发"}},[t._v("#")]),t._v(" 2. 防止 Effect 频繁触发")]),t._v(" "),s("h4",{attrs:{id:"用-usememo-保证对象稳定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用-usememo-保证对象稳定"}},[t._v("#")]),t._v(" 用 useMemo 保证对象稳定")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useMemo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" serverUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" roomId "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("serverUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" roomId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只有 options 变才执行")]),t._v("\n")])])]),s("h4",{attrs:{id:"用-usecallback-保证函数稳定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用-usecallback-保证函数稳定"}},[t._v("#")]),t._v(" 用 useCallback 保证函数稳定")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" createOptions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" serverUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" roomId "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("serverUrl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" roomId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" opts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("createOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只有 roomId/serverUrl 变才执行")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"usememo-和-usecallback-何时用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usememo-和-usecallback-何时用"}},[t._v("#")]),t._v(" useMemo 和 useCallback 何时用？")]),t._v(" "),s("ul",[s("li",[t._v("当"),s("strong",[t._v("需要缓存“值”")]),t._v("（对象、数组、计算结果），用 "),s("strong",[t._v("useMemo")]),t._v("。")]),t._v(" "),s("li",[t._v("当"),s("strong",[t._v("需要缓存“函数”")]),t._v("（事件处理器、回调、给子组件的 props），用 "),s("strong",[t._v("useCallback")]),t._v("。")]),t._v(" "),s("li",[t._v("如果你发现因为 props/函数引用变化导致子组件或 effect 频繁重复执行，就要考虑它们。")]),t._v(" "),s("li",[t._v("绝大多数情况下，"),s("code",[t._v("useCallback(fn, deps)")]),t._v(" 等同于 "),s("code",[t._v("useMemo(() => fn, deps)")]),t._v("，只是语义更加明确。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"常见误区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见误区"}},[t._v("#")]),t._v(" 常见误区")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("不要滥用")]),t._v("：只有当性能出现瓶颈，或者引用变化导致问题时才需要用。")]),t._v(" "),s("li",[s("strong",[t._v("依赖项要写全")]),t._v("：依赖项缺失会导致 Bug，建议配合 ESLint 规则。")]),t._v(" "),s("li",[s("strong",[t._v("缓存不是持久化")]),t._v("：React 可能在某些场景丢弃缓存（如热更新、虚拟化等），不要依赖缓存做业务逻辑。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("useMemo")]),t._v(" 用于"),s("strong",[t._v("缓存值")]),t._v("，"),s("code",[t._v("useCallback")]),t._v(" 用于"),s("strong",[t._v("缓存函数")]),t._v("。")]),t._v(" "),s("li",[t._v("两者都用于性能优化，常与 "),s("code",[t._v("React.memo")]),t._v("、"),s("code",[t._v("useEffect")]),t._v(" 等配合。")]),t._v(" "),s("li",[t._v("选择用哪个，关键看你要缓存的是“值”还是“函数”。")])]),t._v(" "),s("blockquote",[s("p",[t._v("多练习、结合实际场景体会两者区别，有助于写出高性能的 React 组件！")])])])}),[],!1,null,null,null);s.default=e.exports}}]);