(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{281:function(e,s,t){},291:function(e,s,t){"use strict";t(281)},300:function(e,s,t){"use strict";t.r(s);t(121),t(119),t(15),t(63);var n=t(309),i={name:"MiniSearch",data:()=>({miniSearch:null,searchIndex:[],searchQuery:"",suggestions:[],focused:!1,focusIndex:0,placeholder:"搜索...",alignRight:!1}),computed:{showSuggestions(){return this.focused&&(this.suggestions.length>0||this.searchQuery)},searchInputStyle(){return{"background-image":`url(${this.$withBase("/search.svg")})`}}},async mounted(){this.placeholder=this.$site.themeConfig.searchPlaceholder||"搜索...",await this.loadIndex(),this.initMiniSearch()},methods:{async loadIndex(){try{const e=await fetch(this.$withBase("/search-index.json"));if(!e.ok)throw new Error("Search index fetch failed: "+e.status);this.searchIndex=await e.json(),console.log(`[SearchBox Debug] v3 索引已加载, ${this.searchIndex.length} 篇文档.`)}catch(e){console.error("[SearchBox Debug] 加载 v3 索引失败:",e)}},initMiniSearch(){this.searchIndex&&0!==this.searchIndex.length?(this.miniSearch=new n.a({fields:["pageTitle","headerTitle","text"],storeFields:["path","pageTitle","headerTitle","text"],searchOptions:{boost:{pageTitle:3,headerTitle:2,text:1},prefix:!0,fuzzy:.2}}),this.miniSearch.addAll(this.searchIndex),console.log("[SearchBox Debug] MiniSearch v3 已初始化.")):console.warn("[SearchBox Debug] 索引为空, MiniSearch 无法初始化.")},performSearch(){if(this.searchQuery&&this.miniSearch)try{const e=this.miniSearch.search(this.searchQuery,{highlight:!0});this.suggestions=this.groupAndHighlightResults(e,this.searchQuery),this.focusIndex=this.findNextFocusableIndex(-1,"down")}catch(e){console.error("[SearchBox Debug] 搜索出错:",e),this.suggestions=[]}else this.suggestions=[]},groupAndHighlightResults(e,s){const t={},n=new RegExp(`(${this.escapeRegExp(s)})`,"gi");e.slice(0,15).forEach(e=>{const i=e.pageTitle.replace(n,'<span class="highlight-text">$1</span>');t[i]||(t[i]=[]);const o=(e.headerTitle||"概述").replace(n,'<span class="highlight-text">$1</span>'),r=this.createSnippet(e.text,s,e.match.text,n,'<span class="highlight-text">$1</span>');t[i].push({path:e.path,headerTitle:o,snippet:r})});const i=[];for(const e in t)i.push({type:"groupHeader",title:e}),t[e].forEach(e=>{i.push({type:"result",...e})});return i},createSnippet(e,s,t,n,i){if(!e||!s)return"";const o=e.toLowerCase().indexOf(s.toLowerCase());if(-1===o&&(!t||0===t.length))return e.substring(0,80)+(e.length>80?"...":"");let r=o;t&&t.length>0&&(r=t[0][0]);const a=Math.max(0,r-40),h=Math.min(e.length,a+80);let u=e.substring(a,h);return a>0&&(u="..."+u),h<e.length&&(u+="..."),u=u.replace(n,i),u},escapeRegExp:e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),go(e){if(!this.showSuggestions)return;const s=this.suggestions[e];s&&"result"===s.type&&(this.$router.push(s.path),this.closeDropdown())},closeDropdown(){this.searchQuery="",this.suggestions=[],this.focused=!1,this.$refs.input.blur()},onBlur(){setTimeout(()=>{this.focused=!1},200)},onUp(){this.focusIndex=this.findNextFocusableIndex(this.focusIndex,"up")},onDown(){this.focusIndex=this.findNextFocusableIndex(this.focusIndex,"down")},focus(e){this.focusIndex=e},unfocus(){this.focusIndex=-1},findNextFocusableIndex(e,s){if(!this.suggestions.length)return-1;const t="down"===s?1:-1;let n=e+t;for(;n>=0&&n<this.suggestions.length;){if("result"===this.suggestions[n].type)return n;n+=t}return"up"===s&&n<0?this.findNextFocusableIndex(-1,"down"):"down"===s&&n>=this.suggestions.length?this.findNextFocusableIndex(this.suggestions.length,"up"):e}}},o=(t(291),t(27)),r=Object(o.a)(i,(function(){var e=this,s=e._self._c;return s("div",{staticClass:"search-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchQuery,expression:"searchQuery"}],ref:"input",class:{focused:e.focused},style:e.searchInputStyle,attrs:{"aria-label":"Search",placeholder:e.placeholder,autocomplete:"off",spellcheck:"false"},domProps:{value:e.searchQuery},on:{input:[function(s){s.target.composing||(e.searchQuery=s.target.value)},e.performSearch],focus:function(s){e.focused=!0},blur:e.onBlur,keyup:[function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.go(e.focusIndex)},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"up",38,s.key,["Up","ArrowUp"])?null:e.onUp.apply(null,arguments)},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"down",40,s.key,["Down","ArrowDown"])?null:e.onDown.apply(null,arguments)}]}}),e._v(" "),e.showSuggestions?s("ul",{staticClass:"suggestions",class:{"align-right":e.alignRight},on:{mouseleave:e.unfocus}},[e._l(e.suggestions,(function(t,n){return s("li",{key:n,class:{"group-header-item":"groupHeader"===t.type,"suggestion-item":"result"===t.type,focused:"result"===t.type&&n===e.focusIndex},on:{mousedown:function(s){"result"===t.type&&e.go(n)},mouseenter:function(s){"result"===t.type&&e.focus(n)}}},["groupHeader"===t.type?[s("div",{staticClass:"group-title",domProps:{innerHTML:e._s(t.title)}})]:"result"===t.type?[s("router-link",{attrs:{to:t.path},nativeOn:{click:function(s){return e.closeDropdown.apply(null,arguments)}}},[s("div",{staticClass:"hierarchy-icon"},[s("span",[e._v("#")])]),e._v(" "),s("div",{staticClass:"suggestion-content"},[s("div",{staticClass:"header-main-title",domProps:{innerHTML:e._s(t.headerTitle)}}),e._v(" "),t.snippet?s("div",{staticClass:"snippet",domProps:{innerHTML:e._s(t.snippet)}}):e._e()])])]:e._e()],2)})),e._v(" "),0===e.suggestions.length&&e.searchQuery?s("li",{staticClass:"suggestion-item no-results"},[s("span",[e._v("没有找到结果")])]):e._e()],2):e._e()])}),[],!1,null,null,null);s.default=r.exports}}]);